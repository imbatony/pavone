# PAVOne v0.2.0 开发计划

## 1. Jellyfin 集成 (优先级: 高)

### 功能需求
- [x] 连接 Jellyfin 服务器（支持用户名密码/API Key认证）
- [ ] 自动检测 Jellyfin 库中的视频
- [ ] 为已有视频自动匹配和添加元数据
- [ ] 支持在 Jellyfin 中搜索视频
- [ ] 下载前检查视频是否已在 Jellyfin 中存在

### 技术方案
- 使用 `jellyfin-apiclient-python` 库处理 API 交互（官方库，成熟稳定）
- 创建 `jellyfin/` 模块封装 Jellyfin 业务逻辑
- 扩展 Search 插件支持 Jellyfin 搜索
- 在下载流程中添加去重检查
- 支持自动刷新 Jellyfin 库

### 依赖库
- `jellyfin-apiclient-python` - 官方 Jellyfin API 客户端

### 交付物
- `pavone/jellyfin/` 模块
- Jellyfin 配置文档
- 测试用例

---

## 2. 新增视频提取器 (优先级: 中)

### 目标提取器（至少新增 2-3 个）
- [ ] **JAVDB** - 流行的日本AV网站
- [ ] **Javmost** - 提供多种格式的提取
- [ ] **FC2** - 直播平台视频提取
- [ ] **JVID** - 另一个日本视频源

### 开发流程
- 分析每个网站的结构和API
- 实现基础提取器（继承自 `ExtractorPlugin`）
- 添加元数据提取逻辑
- 编写单元测试（目标覆盖率 > 80%）
- 更新 README 和文档

### 交付物
- 新提取器实现
- 相应的测试用例
- 文档更新

---

## 3. 下载缓存优化 (优先级: 中)

### 优化目标
- [ ] 实现智能缓存机制（避免重复下载相同链接）
- [ ] 支持缓存过期策略（TTL 配置）
- [ ] 缓存数据持久化（数据库或文件）
- [ ] 提供缓存统计和管理命令

### 技术方案
- 在 `Manager` 中添加缓存层
- 使用 SQLite 存储缓存元数据
- 支持缓存预热和清理
- 添加缓存命中率监控

### 交付物
- 缓存管理模块
- 新的 CLI 命令：`pavone cache clear/stats/warm`
- 文档说明

---

## 4. 元数据本地数据库缓存 (优先级: 高)

### 功能需求
- [ ] 构建元数据本地 SQLite 数据库
- [ ] 支持按视频代码、标题、网站等多维度查询
- [ ] 自动去重（同一视频的多个源只保存一份）
- [ ] 支持元数据版本管理和更新
- [ ] 提供元数据导入导出功能

### 技术方案
- 创建 `pavone/database/` 模块处理数据库操作
- 定义元数据 Schema（支持扩展字段）
- 实现 ORM 层简化数据操作
- 在提取器中集成数据库存储
- 在搜索时优先查询本地数据库

### 数据库设计
- **videos** 表 - 核心元数据
- **sources** 表 - 多源跟踪
- **metadata_history** 表 - 版本历史
- **search_index** 表 - 优化搜索性能

### 新增 CLI 命令
- `pavone db init` - 初始化数据库
- `pavone db query` - 查询元数据
- `pavone db export` - 导出数据
- `pavone db import` - 导入数据
- `pavone db stats` - 统计信息

### 交付物
- 数据库模块和 ORM
- 新的 CLI 命令实现
- 数据库迁移脚本
- 文档和使用示例

---

## 5. 其他改进 (优先级: 低)

### 代码质量
- [ ] 提高单元测试覆盖率（目标 > 85%）
- [ ] 添加更多集成测试
- [ ] 性能优化分析

### 文档完善
- [ ] 更新 API 文档
- [ ] 添加开发者指南示例
- [ ] 补充常见问题 (FAQ)

### 依赖更新
- [ ] 评估和更新主要依赖
- [ ] 检查安全漏洞

---

## 开发时间线

| 阶段 | 任务 | 预计时间 |
|------|------|--------|
| Phase 1 | 元数据数据库缓存 | 1-2 周 |
| Phase 2 | Jellyfin 集成 | 1-2 周 |
| Phase 3 | 新提取器开发 | 1-2 周 |
| Phase 4 | 下载缓存优化 | 1 周 |
| Phase 5 | 测试和优化 | 1 周 |
| Phase 6 | 发布准备 | 3-5 天 |

---

## 发布检查清单

- [ ] 所有功能已实现并测试通过
- [ ] 代码审查完成
- [ ] 文档已更新
- [ ] 变更日志 (CHANGELOG) 已更新
- [ ] 版本号确认为 0.2.0
- [ ] 标签 (tag) 已创建
- [ ] 发布说明已准备