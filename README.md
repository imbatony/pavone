# PAVOne (WIP)

[![CI/CD Pipeline](https://github.com/imbatony/pavone/actions/workflows/ci.yml/badge.svg)](https://github.com/username/pavone/actions/workflows/ci.yml)
[![Code Quality Check](https://github.com/imbatony/pavone/actions/workflows/code-quality.yml/badge.svg)](https://github.com/imbatony/pavone/actions/workflows/code-quality.yml)
[![Python Version](https://img.shields.io/badge/python-3.9+-blue.svg)](https://www.python.org/downloads/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Code style: black](https://img.shields.io/badge/code%20style-black-000000.svg)](https://github.com/psf/black)


## å…³äº
PAVOne(WIP)æ˜¯ä¸€ä¸ªé›†ä¸‹è½½ã€æ•´ç†ç­‰å¤šåŠŸèƒ½çš„æ’ä»¶åŒ–çš„AVç®¡ç†å·¥å…·ã€‚

## ä¸ºä»€ä¹ˆè¦æœ‰è¿™ä¸ªé¡¹ç›®
1. ç›®å‰çš„å…ƒæ•°æ®æŠ“å–å¤§éƒ¨åˆ†åªæ”¯æŒJAVï¼Œå¯¹å…¶ä»–ç±»å‹è§†é¢‘ç½‘ç«™æ²¡æœ‰æ”¯æŒ
2. æµ·æŠ¥å›¾ç¼ºä¹æ‰“æ ‡åŠŸèƒ½å•ä¸€ï¼ŒæŸ¥æ‰¾ç¹ç 
3. ä¸‹è½½å·¥å…·å¹¶ä¸è‡ªå¸¦æ•´ç†åŠŸèƒ½ï¼ŒåæœŸæ•´ç†ç¹çè´¹æ—¶
4. æ•´ç†åŠŸèƒ½å¤§éƒ¨åˆ†å¯¹å¤šcdï¼Œç³»åˆ—ç­‰å¤„ç†ä¸æ­£å¸¸
5. å¤šä¸ªå·¥å…·åˆ†æ•£
6. è§†é¢‘åˆ†æ•£åœ¨å¤šä¸ªè§†é¢‘ç½‘ç«™ï¼Œéœ€è¦å¤šæ¬¡å¯»æ‰¾
7. ç¼ºä¹è§†é¢‘å»é‡å’Œè´¨é‡å‡çº§åŠŸèƒ½

## ç‰¹æ€§

### ğŸ¬ è§†é¢‘ä¸‹è½½
- **å¤šåè®®æ”¯æŒ**: HTTP/HTTPSã€M3U8 (HLS) æµåª’ä½“ä¸‹è½½
- **å¹¶å‘ä¸‹è½½**: å¤šçº¿ç¨‹å¹¶å‘ä¸‹è½½ï¼Œæå‡ä¸‹è½½æ•ˆç‡  
- **æ–­ç‚¹ç»­ä¼ **: æ”¯æŒå¤§æ–‡ä»¶çš„æ–­ç‚¹ç»­ä¼ åŠŸèƒ½
- **ä»£ç†æ”¯æŒ**: å®Œæ•´çš„HTTP/HTTPSä»£ç†é…ç½®
- **è¿›åº¦ç›‘æ§**: å®æ—¶ä¸‹è½½è¿›åº¦æ˜¾ç¤ºå’Œå›è°ƒ

### ğŸ“Š å…ƒæ•°æ®ç®¡ç†
- **æ™ºèƒ½æå–**: è‡ªåŠ¨æå–è§†é¢‘å…ƒæ•°æ®ä¿¡æ¯
- **å¤šæºæ”¯æŒ**: æ”¯æŒå¤šç§æ•°æ®æºå’Œç½‘ç«™
- **æ ‡å‡†åŒ–**: ç»Ÿä¸€çš„å…ƒæ•°æ®æ ¼å¼å’Œå­˜å‚¨

### ğŸ“ æ–‡ä»¶æ•´ç†
- **æ™ºèƒ½æ•´ç†**: åŸºäºå…ƒæ•°æ®çš„æ™ºèƒ½æ–‡ä»¶æ•´ç†
- **å¤šç§æ¨¡å¼**: æ”¯æŒæŒ‰åˆ¶ä½œå•†ã€æ¼”å‘˜ã€ç±»å‹ç­‰æ•´ç†æ–¹å¼
- **é‡å¤æ£€æµ‹**: æ™ºèƒ½é‡å¤æ–‡ä»¶æ£€æµ‹å’Œå¤„ç†
- **æ‰¹é‡å¤„ç†**: æ”¯æŒæ‰¹é‡æ–‡ä»¶æ“ä½œ

### ğŸ” æœç´¢åŠŸèƒ½
- **è·¨å¹³å°æœç´¢**: æ”¯æŒå¤šä¸ªè§†é¢‘ç½‘ç«™çš„ç»Ÿä¸€æœç´¢
- **å…³é”®è¯æœç´¢**: çµæ´»çš„å…³é”®è¯å’Œåˆ†ç±»æœç´¢
- **ç»“æœèšåˆ**: æ™ºèƒ½æœç´¢ç»“æœèšåˆå’Œæ’åº

### ğŸ”§ å¼€å‘ç‰¹æ€§
- **æ’ä»¶åŒ–æ¶æ„**: å¯æ‰©å±•çš„æ’ä»¶ç³»ç»Ÿ
- **ç±»å‹å®‰å…¨**: å®Œæ•´çš„ç±»å‹æ³¨è§£å’Œæ£€æŸ¥
- **æµ‹è¯•è¦†ç›–**: å…¨é¢çš„å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
- **CI/CD**: è‡ªåŠ¨åŒ–çš„ä»£ç è´¨é‡æ£€æŸ¥å’Œéƒ¨ç½²

## å®‰è£…

### ğŸ“‹ ç¯å¢ƒè¦æ±‚
- Python 3.9+ 
- Windows/Linux/macOS

### ğŸš€ å¿«é€Ÿå®‰è£…

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/imbatony/pavone.git
cd pavone

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# å¼€å‘æ¨¡å¼å®‰è£…
pip install -e .
```

### ğŸ“¦ PyPIå®‰è£… (å³å°†æ”¯æŒ)
```bash
pip install pavone
```

## å¿«é€Ÿå¼€å§‹

### åˆå§‹åŒ–é…ç½®

```bash
pavone init
```

### ä¸‹è½½è§†é¢‘

```bash
# ä¸‹è½½å•ä¸ªè§†é¢‘
pavone download "https://example.com/video.mp4"

### ä¸‹è½½è§†é¢‘

```bash
# HTTP/HTTPSè§†é¢‘ä¸‹è½½
pavone download "https://example.com/video.mp4"

# M3U8æµåª’ä½“ä¸‹è½½
pavone download "https://example.com/video/playlist.m3u8" --filename "my_video.mp4"

# å¸¦è‡ªå®šä¹‰å¤´éƒ¨çš„ä¸‹è½½
pavone download "https://secure.example.com/video.mp4" \
  --header "Authorization: Bearer token123" \
  --header "Referer: https://example.com"

# ä½¿ç”¨ä»£ç†ä¸‹è½½
pavone download "https://example.com/video.mp4" \
  --proxy "http://127.0.0.1:7890"

# ä¸‹è½½å¹¶è‡ªåŠ¨æ•´ç†
pavone download "https://example.com/video.mp4" --organize

# è‡ªåŠ¨é€‰æ‹©ç¬¬ä¸€ä¸ªä¸‹è½½é€‰é¡¹
pavone download "https://missav.ai/video/12345" --auto-select

# é™é»˜ä¸‹è½½ï¼ˆæ— è¿›åº¦æ˜¾ç¤ºï¼‰
pavone download "https://example.com/video.mp4" --silent

# æ‰¹é‡ä¸‹è½½
pavone batch-download urls.txt --auto-select
```

### æœç´¢è§†é¢‘

```bash
# æœç´¢å…³é”®è¯
pavone search "å…³é”®è¯"

# åœ¨ç‰¹å®šç½‘ç«™æœç´¢
pavone search "å…³é”®è¯" --site javbus
```

### æ•´ç†è§†é¢‘æ–‡ä»¶

```bash
# æ•´ç†æŒ‡å®šç›®å½•
pavone organize "/path/to/videos"

# æŒ‰åˆ¶ä½œå•†æ•´ç†
pavone organize "/path/to/videos" --by studio

# æŸ¥æ‰¾é‡å¤æ–‡ä»¶
pavone organize "/path/to/videos" --find-duplicates
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
pavone/
â”œâ”€â”€ pavone/                    # ä¸»åŒ…
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ cli.py                 # å‘½ä»¤è¡Œå…¥å£
â”‚   â”œâ”€â”€ core/                  # æ ¸å¿ƒåŠŸèƒ½æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base.py            # åŸºç¡€æ“ä½œç±»
â”‚   â”‚   â”œâ”€â”€ dummy.py           # æµ‹è¯•ç”¨å ä½æ“ä½œç±»
â”‚   â”‚   â””â”€â”€ downloader/        # ä¸‹è½½å™¨æ¨¡å—
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ base.py        # åŸºç¡€ä¸‹è½½å™¨ç±»
â”‚   â”‚       â”œâ”€â”€ http_downloader.py  # HTTPä¸‹è½½å™¨
â”‚   â”‚       â””â”€â”€ m3u8_downloader.py  # M3U8æµåª’ä½“ä¸‹è½½å™¨
â”‚   â”œâ”€â”€ models/                # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ operation.py       # æ“ä½œé¡¹æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ constants.py       # å¸¸é‡å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ metadata.py        # å…ƒæ•°æ®æ¨¡å‹
â”‚   â”‚   â””â”€â”€ progress_info.py   # è¿›åº¦ä¿¡æ¯æ¨¡å‹
â”‚   â”œâ”€â”€ manager/               # ç®¡ç†å™¨æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ execution.py       # æ‰§è¡Œç®¡ç†å™¨
â”‚   â”‚   â””â”€â”€ progress.py        # è¿›åº¦ç®¡ç†
â”‚   â”œâ”€â”€ plugins/               # æ’ä»¶ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base.py           # æ’ä»¶åŸºç±»
â”‚   â”‚   â”œâ”€â”€ manager.py        # æ’ä»¶ç®¡ç†å™¨
â”‚   â”‚   â””â”€â”€ extractors/       # æå–å™¨æ’ä»¶
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ base.py       # æå–å™¨åŸºç±»
â”‚   â”‚       â”œâ”€â”€ missav_extractor.py    # MissAVæå–å™¨
â”‚   â”‚       â”œâ”€â”€ m3u8_direct.py         # M3U8ç›´é“¾æå–å™¨
â”‚   â”‚       â””â”€â”€ mp4_direct.py          # MP4ç›´é“¾æå–å™¨
â”‚   â”œâ”€â”€ utils/                # å·¥å…·æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ stringutils.py    # å­—ç¬¦ä¸²å·¥å…·
â”‚   â””â”€â”€ config/               # é…ç½®ç®¡ç†
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ configs.py        # é…ç½®ç±»å®šä¹‰
â”‚       â”œâ”€â”€ manager.py        # é…ç½®ç®¡ç†å™¨
â”‚       â”œâ”€â”€ settings.py       # é…ç½®è®¾ç½®
â”‚       â”œâ”€â”€ validator.py      # é…ç½®éªŒè¯å™¨
â”‚       â””â”€â”€ logging_config.py # æ—¥å¿—é…ç½®
â”œâ”€â”€ tests/                    # æµ‹è¯•å¥—ä»¶
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ test_downloader.py    # åŸºç¡€ä¸‹è½½å™¨æµ‹è¯•
â”‚   â”œâ”€â”€ test_m3u8_downloader.py  # M3U8ä¸‹è½½å™¨æµ‹è¯•
â”‚   â””â”€â”€ test_organizer.py     # æ–‡ä»¶æ•´ç†æµ‹è¯•
â”œâ”€â”€ docs/                     # æ–‡æ¡£
â”‚   â”œâ”€â”€ config.md             # é…ç½®æ–‡æ¡£
â”‚   â”œâ”€â”€ development.md        # å¼€å‘æ–‡æ¡£
â”‚   â””â”€â”€ usage.md              # ä½¿ç”¨æ–‡æ¡£
â”œâ”€â”€ pyproject.toml            # é¡¹ç›®é…ç½®
â”œâ”€â”€ pyrightconfig.json        # Pylanceé…ç½®
â”œâ”€â”€ setup.cfg                 # å·¥å…·é…ç½®
â”œâ”€â”€ setup.py                  # å®‰è£…è„šæœ¬
â”œâ”€â”€ requirements.txt          # ä¾èµ–åˆ—è¡¨
â”œâ”€â”€ LICENSE                   # å¼€æºåè®®
â”œâ”€â”€ dev.ps1                   # å¼€å‘è„šæœ¬
â””â”€â”€ README.md                 # é¡¹ç›®è¯´æ˜
```

## ğŸš€ æ ¸å¿ƒåŠŸèƒ½

### ğŸ“¥ ä¸‹è½½å™¨ç³»ç»Ÿ
- **`BaseDownloader`**: ä¸‹è½½å™¨åŸºç±»ï¼Œå®šä¹‰ç»Ÿä¸€æ¥å£
- **`HTTPDownloader`**: HTTP/HTTPSåè®®ä¸‹è½½å™¨
  - æ”¯æŒå¤šçº¿ç¨‹å¹¶å‘ä¸‹è½½
  - æ–­ç‚¹ç»­ä¼ åŠŸèƒ½
  - Rangeè¯·æ±‚æ”¯æŒ
  - è‡ªåŠ¨é‡è¯•æœºåˆ¶
- **`M3U8Downloader`**: HLSæµåª’ä½“ä¸‹è½½å™¨
  - M3U8æ’­æ”¾åˆ—è¡¨è§£æ
  - å¹¶å‘è§†é¢‘æ®µä¸‹è½½
  - è‡ªåŠ¨æ–‡ä»¶åˆå¹¶
  - å®æ—¶è¿›åº¦ç›‘æ§

### ğŸ“Š å…ƒæ•°æ®ç³»ç»Ÿ
- **æ™ºèƒ½æå–**: è‡ªåŠ¨è¯†åˆ«å’Œæå–è§†é¢‘å…ƒä¿¡æ¯
- **å¤šæºèšåˆ**: æ”¯æŒå¤šä¸ªå…ƒæ•°æ®æºçš„ä¿¡æ¯èšåˆ
- **æ ‡å‡†åŒ–æ ¼å¼**: ç»Ÿä¸€çš„å…ƒæ•°æ®ç»“æ„å’Œå­˜å‚¨æ ¼å¼
- **å¯æ‰©å±•æ¶æ„**: é€šè¿‡æ’ä»¶ç³»ç»Ÿæ”¯æŒæ–°çš„å…ƒæ•°æ®æº

### ğŸ“ æ–‡ä»¶æ•´ç†ç³»ç»Ÿ
- **æ™ºèƒ½åˆ†ç±»**: åŸºäºå…ƒæ•°æ®çš„æ™ºèƒ½æ–‡ä»¶åˆ†ç±»å’Œæ•´ç†
- **å¤šç§æ¨¡å¼**: æ”¯æŒæŒ‰åˆ¶ä½œå•†ã€æ¼”å‘˜ã€ç±»å‹ã€æ—¥æœŸç­‰ç»´åº¦æ•´ç†
- **é‡å¤æ£€æµ‹**: é«˜æ•ˆçš„é‡å¤æ–‡ä»¶æ£€æµ‹ç®—æ³•
- **æ‰¹é‡æ“ä½œ**: æ”¯æŒå¤§æ‰¹é‡æ–‡ä»¶çš„å¿«é€Ÿå¤„ç†

### ğŸ” æœç´¢ç³»ç»Ÿ
- **ç»Ÿä¸€æ¥å£**: æä¾›ç»Ÿä¸€çš„æœç´¢æ¥å£å’Œç»“æœæ ¼å¼
- **å¤šæºæœç´¢**: åŒæ—¶æœç´¢å¤šä¸ªè§†é¢‘ç½‘ç«™å’Œæ•°æ®æº
- **æ™ºèƒ½æ’åº**: åŸºäºç›¸å…³æ€§å’Œè´¨é‡çš„æœç´¢ç»“æœæ’åº
- **ç¼“å­˜æœºåˆ¶**: æœç´¢ç»“æœç¼“å­˜ï¼Œæå‡å“åº”é€Ÿåº¦

## âš™ï¸ é…ç½®

é…ç½®æ–‡ä»¶ä½äº `~/.pavone/config.json`ï¼š

```json
{
  "download": {
    "output_dir": "./downloads",
    "max_concurrent_downloads": 4,
    "retry_times": 3,
    "timeout": 30,
    "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",
    "proxy_enabled": false,
    "http_proxy": "",
    "https_proxy": ""
  },
  "organize": {
    "auto_organize": true,
    "organize_by": "studio",
    "naming_pattern": "{studio}-{code}-{title}",
    "create_directories": true
  },
  "search": {
    "max_results_per_site": 20,
    "enabled_sites": ["javbus", "javlibrary"],
    "cache_enabled": true,
    "cache_duration": 3600
  },
  "metadata": {
    "auto_fetch": true,
    "preferred_language": "zh-CN",
    "fallback_language": "en-US"
  }
}
```

## ğŸ“š æ–‡æ¡£

è¯¦ç»†æ–‡æ¡£è¯·å‚è€ƒï¼š

- [ä½¿ç”¨æ–‡æ¡£](docs/usage.md) - å®Œæ•´çš„ä½¿ç”¨æŒ‡å—å’Œç¤ºä¾‹
- [é…ç½®æ–‡æ¡£](docs/config.md) - è¯¦ç»†çš„é…ç½®é€‰é¡¹è¯´æ˜
- [å¼€å‘æ–‡æ¡£](docs/development.md) - å¼€å‘æŒ‡å—å’ŒAPIæ–‡æ¡£

## ğŸ¤ è´¡çŒ®

æˆ‘ä»¬æ¬¢è¿æ‰€æœ‰å½¢å¼çš„è´¡çŒ®ï¼è¯·é˜…è¯»æˆ‘ä»¬çš„è´¡çŒ®æŒ‡å—ï¼š

### è´¡çŒ®æµç¨‹
1. Fork æœ¬ä»“åº“
2. åˆ›å»ºæ‚¨çš„åŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. æäº¤æ‚¨çš„æ›´æ”¹ (`git commit -m 'Add some amazing feature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
5. æ‰“å¼€ä¸€ä¸ª Pull Request

### ä»£ç è´¨é‡
- æ‰€æœ‰ä»£ç å¿…é¡»é€šè¿‡ Pylance/Pyright ç±»å‹æ£€æŸ¥
- éµå¾ª Black ä»£ç æ ¼å¼åŒ–æ ‡å‡†
- æ·»åŠ é€‚å½“çš„å•å…ƒæµ‹è¯•
- æ›´æ–°ç›¸å…³æ–‡æ¡£

## ğŸ§ª å¼€å‘

### è¿è¡Œæµ‹è¯•
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
python -m pytest tests/ -v

# è¿è¡Œç‰¹å®šæµ‹è¯•
python -m pytest tests/test_m3u8_downloader.py -v

# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
python -m pytest tests/ --cov=pavone --cov-report=html
```

### ä»£ç è´¨é‡æ£€æŸ¥
```bash
# ç±»å‹æ£€æŸ¥
pyright pavone/

# ä»£ç æ ¼å¼åŒ–
black pavone/ tests/
isort pavone/ tests/

# ä»£ç é£æ ¼æ£€æŸ¥
flake8 pavone/ tests/
pylint pavone/
```

### å¯ç”¨è¯¦ç»†æ—¥å¿—
```bash
pavone --verbose download "url"
```

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ™ è‡´è°¢

æ„Ÿè°¢æ‰€æœ‰è´¡çŒ®è€…å’Œå¼€æºç¤¾åŒºçš„æ”¯æŒï¼